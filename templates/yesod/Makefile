# This Makefile was generated by the made script:
# https://github.com/alx741/made
#
# Replace PACKAGE with the package name of your project
# 		('name' attribute of the cabal file)
#
# Dependencies:
# 	stack
# 	tmux
# 	tddlight (https://github.com/alx741/tdd_traffic-light)
#
# Usage:
#	- Append `runCommand "make serverReloaded"` to the 'update' function in
#		'DevelMain.hs' of your scaffolded site. Inside the 'Just' case:
#
#		Just tidStore -> do
#			restartAppInNewThread tidStore
#			runCommand "make serverReloaded"
#			return ()
#
#  - Start your development session with `make init`
#  - Recompile with `make build`


PACKAGE=your_file

build:
	@tddlight yellow

	@# Halt dev server
	@tmux send-keys -t "yesod" "DevelMain.shutdown"
	@tmux send-keys -t "yesod" "Enter"

	@# Rebuild
	stack build --fast --flag $(PACKAGE):dev --flag $(PACKAGE):library-only || tddlight red

	@# Restart dev server
	@tmux send-keys -t "yesod" ":l DevelMain"
	@tmux send-keys -t "yesod" "Enter"
	@tmux send-keys -t "yesod" "DevelMain.update"
	@tmux send-keys -t "yesod" "Enter"


init:
	tddlight clear
	tmux new-window -n "yesod" "stack ghci"
	tmux send-keys -t "yesod" ":l DevelMain"
	tmux send-keys -t "yesod" "Enter"
	tmux send-keys -t "yesod" "DevelMain.update"
	tmux send-keys -t "yesod" "Enter"

serverReloaded:
	@tddlight green
